name: 'Test Workflow'
on: [push]

jobs:
  test:
    name: test amplify-cli-action
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [10.x]

    steps:
    - uses: actions/checkout@v1

    - name: use node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v1
      with:
        node-version: ${{ matrix.node-version }}

    - name: install dependencies
      run: |
        echo $NODE_ENV
        npm config set -g production false
        npm install
        npm install --save-dev git+https://github.com/ambientlight/amplify-cli.git#ambientlight
        ls ./node_modules/.bin
        if [ ! -f /node_modules/.bin/amplify ] ; then
          echo "amplify not found"
        else
          echo "amplify found"
        fi

    # - name: add test environment
    #   uses: ambientlight/amplify-cli-action@master
    #   with:
    #     amplify_command: add_env
    #     amplify_env: prtest
    #   env:
    #     AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
    #     AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    #     AWS_REGION: ap-southeast-1
        
    # - name: build and test
    #   run: |
    #     npm run build
    #     npm run test
        
    # - name: undeploy test environment
    #   uses: ambientlight/amplify-cli-action@master
    #   with:
    #     amplify_command: delete
    #     delete_lock: false
    #     amplify_env: prtest
    #   env:
    #     AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
    #     AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    #     AWS_REGION: ap-southeast-1
